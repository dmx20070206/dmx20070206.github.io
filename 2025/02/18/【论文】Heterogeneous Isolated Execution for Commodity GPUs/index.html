

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/DMX.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="DM-X~X~X">
  <meta name="keywords" content="">
  
    <meta name="description" content="论文思路整理Threat ModuleHIX ArchitectureArchitecture Overview 目标：保护主机和 GPU 的数据通路，将 Driver 运行在 enclave 中，OS 无法修改 MMIO 映射和 PCIe 路由。 必须的硬件&#x2F;软件修改：  Isolated GPU management with GPU enclave: 将 GPU Driver">
<meta property="og:type" content="article">
<meta property="og:title" content="【论文】Heterogeneous Isolated Execution for Commodity GPUs">
<meta property="og:url" content="https://dmx20070206.github.io/2025/02/18/%E3%80%90%E8%AE%BA%E6%96%87%E3%80%91Heterogeneous%20Isolated%20Execution%20for%20Commodity%20GPUs/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="论文思路整理Threat ModuleHIX ArchitectureArchitecture Overview 目标：保护主机和 GPU 的数据通路，将 Driver 运行在 enclave 中，OS 无法修改 MMIO 映射和 PCIe 路由。 必须的硬件&#x2F;软件修改：  Isolated GPU management with GPU enclave: 将 GPU Driver">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://dmx20070206.github.io/img/HIX/F3.png">
<meta property="og:image" content="https://dmx20070206.github.io/img/HIX/T1.png">
<meta property="og:image" content="https://dmx20070206.github.io/img/HIX/F4.png">
<meta property="og:image" content="https://dmx20070206.github.io/img/HIX/F5.png">
<meta property="og:image" content="https://dmx20070206.github.io/img/HIX/F1.png">
<meta property="article:published_time" content="2025-02-17T16:00:00.000Z">
<meta property="article:modified_time" content="2025-02-28T17:20:11.167Z">
<meta property="article:author" content="DM-X~X~X">
<meta property="article:tag" content="GPU TEE">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://dmx20070206.github.io/img/HIX/F3.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>【论文】Heterogeneous Isolated Execution for Commodity GPUs - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"dmx20070206.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>DM-X~X~X</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>Links</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="【论文】Heterogeneous Isolated Execution for Commodity GPUs"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-02-18 00:00" pubdate>
          February 18, 2025 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          1.9k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          16 mins
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> views
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">【论文】Heterogeneous Isolated Execution for Commodity GPUs</h1>
            
            
              <div class="markdown-body">
                
                <link rel="stylesheet" href="/css/GPU_TEE.css">

<h2 id="论文思路整理"><a href="#论文思路整理" class="headerlink" title="论文思路整理"></a>论文思路整理</h2><h3 id="Threat-Module"><a href="#Threat-Module" class="headerlink" title="Threat Module"></a>Threat Module</h3><h3 id="HIX-Architecture"><a href="#HIX-Architecture" class="headerlink" title="HIX Architecture"></a>HIX Architecture</h3><h4 id="Architecture-Overview"><a href="#Architecture-Overview" class="headerlink" title="Architecture Overview"></a>Architecture Overview</h4><p><img src="/img/HIX/F3.png" srcset="/img/loading.gif" lazyload></p>
<p>目标：保护主机和 GPU 的数据通路，将 Driver 运行在 enclave 中，OS 无法修改 MMIO 映射和 PCIe 路由。</p>
<p>必须的硬件&#x2F;软件修改：</p>
<ol>
<li>Isolated GPU management with GPU enclave: 将 GPU Driver 运行在 GPU enclave 中，只有 GPU enclave 可以访问 MMIO 区域</li>
<li>Secure hardware I&#x2F;O path: 对 SGX 做硬件扩展，OS 无法修改 GPU MMIO region，OS 无法修改 PCIe 路由，保护通过 MMIO&#x2F;DMA 传输的命令&#x2F;代码&#x2F;数据</li>
<li>Trusted application-to-GPU communication: U-enclave 发起的 GPU 命令要先通过对称加密的密钥保护的信道传递给 G-enclave，由其作为代表发送</li>
</ol>
<p><img src="/img/HIX/T1.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="GPU-Enclave"><a href="#GPU-Enclave" class="headerlink" title="GPU Enclave"></a>GPU Enclave</h4><p>G-Enclave 的目标：对 GPU 的单一控制 + 用户访问 GPU 的唯一接口</p>
<p>HIX 将 GPU Driver 的核心功能转移至 G-enclave，其他良性内核功能仍保留在内核中。需要对 SGX 做扩展，使有且仅有 G-enclave 可以访问 GPU MMIO 区域。</p>
<h5 id="GPU-MMIO-Registration"><a href="#GPU-MMIO-Registration" class="headerlink" title="GPU MMIO Registration"></a>GPU MMIO Registration</h5><p>HIX 扩展了两条 SGX 指令，EGCREATE, EGADD，用于注册 GPU MMIO regions</p>
<p>扩展的硬件需要知道：</p>
<ol>
<li>哪部分 MMIO region 应该被保护起来</li>
<li>这部分 MMIO region 应该被映射到 G-enclave 的哪部分地址空间</li>
<li>哪个 G-enclave 应该被允许访问</li>
</ol>
<p>HIX 新增了两种数据结构，存放到 EPC 中</p>
<ol>
<li>GPU enclave control structure (GECS): the control information regarding the GPU enclave including the hardware GPU number and GPU enclave ID.</li>
<li>GPU MMIO region table (TGMR): the virtual and physical address mapping information of the GPU MMIO region, which is used to verify the address mapping for the MMIO region.</li>
</ol>
<p><img src="/img/HIX/F4.png" srcset="/img/loading.gif" lazyload></p>
<p>（1）通过指令 EGCREATE 创建 G-enclave：将 &lt;GPU-BDF, G-enclave-ID&gt; 存放进 GECS 中，保证同一个 G-enclave 只对应一个 GPU<br>（2）通过指令 EADD 添加 GPU MMIO 区域的 &lt;VA, PA&gt; 存放进 TGMR 中，之后对 MMIO region 的访问会经过验证</p>
<h5 id="GPU-Initialization-and-Measurement"><a href="#GPU-Initialization-and-Measurement" class="headerlink" title="GPU Initialization and Measurement"></a>GPU Initialization and Measurement</h5><p>G-enclave 创建并加载后，首先验证 GPU BIOS 的完整性，并彻底清空 GPU 的状态</p>
<h5 id="GPU-Protection-on-GPU-Enclave-Termination"><a href="#GPU-Protection-on-GPU-Enclave-Termination" class="headerlink" title="GPU Protection on GPU Enclave Termination"></a>GPU Protection on GPU Enclave Termination</h5><p>如果 OS 强行杀死 G-enclave 进程，杀死的 G-enclave 进程仍然唯一的拥有 GPU 对应资源，除非系统断电重启，否则任何软件都无法访问这部分资源，而重启时 GECS 和 TGMR 都会重置并清空 GPU 数据。</p>
<p>如果 OS 优雅的结束 G-enclave 进程，G-enclave 会先清空 GPU 数据并将 GPU 使用权还给 OS，同时通知 U-enclave GPU 不再可信。</p>
<h4 id="Securing-I-O-Path-MMIO-and-DMA"><a href="#Securing-I-O-Path-MMIO-and-DMA" class="headerlink" title="Securing I&#x2F;O Path: MMIO and DMA"></a>Securing I&#x2F;O Path: MMIO and DMA</h4><p>保护向 GPU 发送的命令和数据，保护以 MMIO&#x2F;DMA 发送的数据得以保护</p>
<h5 id="MMIO-Access-Protection"><a href="#MMIO-Access-Protection" class="headerlink" title="MMIO Access Protection"></a>MMIO Access Protection</h5><p>发生 TLB Miss 后添加新的 TLB entry 前，硬件 page table walker 会进行四次检查：</p>
<ol>
<li>检查 GECS，确保当前进程是 G-enclave</li>
<li>VA 和 G-enclave 的请求对应</li>
<li>VA 和 TGMR 中某一项相符</li>
<li>PA 和 TGMR 对应项相符</li>
</ol>
<h5 id="MMIO-Lockdown-and-Securing-PCIe-Routing"><a href="#MMIO-Lockdown-and-Securing-PCIe-Routing" class="headerlink" title="MMIO Lockdown and Securing PCIe Routing"></a>MMIO Lockdown and Securing PCIe Routing</h5><p>HIX 提供 MMIO 锁机制，即 PCIe RC 在收到主机发来的事务包时，会检测其是否为修改 MMIO 映射或修改 PCIe 路由，若是则直接丢弃该包。</p>
<p>锁机制在 EGCREATE 命令时启用</p>
<h5 id="Trusted-DMA"><a href="#Trusted-DMA" class="headerlink" title="Trusted DMA"></a>Trusted DMA</h5><p>OS 通过恶意篡改 IOMMU 页表可以将 DMA 数据传送至任何页面。HIX 要求 DMA 数据必须进行加密并通过 message authentication code (MAC) 进行验证。</p>
<p>通过该机制，只有加密的 DMA 数据才会出现在不安全的缓冲区，并通过 MAC 验证，密钥的传递是安全的（后文），故 DMA 数据得以保护。</p>
<h4 id="Application-to-GPU-Communication"><a href="#Application-to-GPU-Communication" class="headerlink" title="Application-to-GPU Communication"></a>Application-to-GPU Communication</h4><p><img src="/img/HIX/F5.png" srcset="/img/loading.gif" lazyload></p>
<p>G-enclave 对 GPU 有唯一的控制权，故需要向 U-enclave 提供一些获取 GPU 服务的接口，GPU 和不同的 U-enclave 同i性能使用不同的密钥。</p>
<p><strong>Trusted Runtime User Library</strong></p>
<p>HIX 为 U-enclave 提供了一套安全的 API，U-enclave 通过这些 API 和 GPU 交互，隐藏 HIX 的硬件细节。</p>
<h5 id="Secure-Inter-Enclave-Communication"><a href="#Secure-Inter-Enclave-Communication" class="headerlink" title="Secure Inter-Enclave Communication"></a>Secure Inter-Enclave Communication</h5><p>HIX 使用对称加密技术确保 G-enclave，U-enclave，GPU 三方通信，使用 SGX local attestation 技术完成彼此的验证。</p>
<p>U-enclave 和 G-enclave 中设立了两条通道：message queue 和 shared memory。U-enclave 将发送给 G-enclave 的数据放至 shared memory，然后向 message queue 发送请求，G-enclave 接受并处理数据。</p>
<h5 id="Secure-Communication-between-the-GPU-Enclave-and-GPU"><a href="#Secure-Communication-between-the-GPU-Enclave-and-GPU" class="headerlink" title="Secure Communication between the GPU Enclave and GPU"></a>Secure Communication between the GPU Enclave and GPU</h5><p>GPU command buffer 在 HIX 保护下的 MMIO region，G-enclave 通过 MMIO 向 GPU 发送 U-enclave 对 GPU 的请求。</p>
<p>数据传输链：U-enclave -&gt; G-enclave -&gt; GPU，期间涉及两对密钥的加解密过程，性能开销大。HIX 采取 single-copy 方法，使用相同的密钥，G-enclave 可以发送命令将 GPU 数据复制到 shared memory 或将 shared memory 数据复制到 GPU，复制可以通过 MMIO 或 DMA 来完成。</p>
<h5 id="Communication-Example"><a href="#Communication-Example" class="headerlink" title="Communication Example"></a>Communication Example</h5><p>U-enclave 向 GPU 传递数据&#x2F;命令的流程：</p>
<ol>
<li>向 message queue 发送 cuMemcpyHtoD request，同时附带元数据</li>
<li>向 shared memory 发送加密的实际数据</li>
<li>G-enclave 将加密数据直接复制给 GPU</li>
<li>G-enclave 向 GPU 发送一个解密内核任务，用于对加密数据的解密</li>
</ol>
<h2 id="论文精读"><a href="#论文精读" class="headerlink" title="论文精读"></a>论文精读</h2><h3 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h3><div class="original-text">
    Traditional CPUs and cloud systems based on them have embraced the hardware-based trusted execution environments to securely isolate computation from malicious OS or hardware attacks. However, GPUs and their cloud deployments have yet to include such support for hardware-based trusted computing. As large amounts of sensitive data are offloaded to GPU acceleration in cloud environments, ensuring the security of the data is a current and pressing need. As deployed today, the outsourced GPU model is vulnerable to attacks from compromised privileged software. To support isolated remote execution on GPUs even under vulnerable operating systems, this paper proposes a novel hardware and software architecture, called HIX (Heterogeneous Isolated eXecution). HIX does not require modifications to the GPU architecture to offer protections: Instead, it offers security by modifying the I/O interconnect between the CPU and GPU, and by refactoring the GPU device driver to work from within the CPU trusted environment. A result of the architectural choices behind HIX is that the concept can be applied to other offload accelerators besides GPUs. This work implements the proposed HIX architecture on an emulated machine with KVM and QEMU. Experimental results from the emulated security support with a real GPU show that the performance overhead for security is curtailed to 26% on average for the Rodinia benchmark, while providing secure isolated GPU computing.
</div>

<div class="analysis-section">
    研究背景（2019 年）：GPU 侧的 TEE 尚未实现，而大量敏感数据被卸载到 GPU 上运行（例如外包 GPU 模型），亟需完成 GPU 上的 TEE 部署 <br>
    <br>
    论文提出了一个软硬件架构：HIX，HIX 不需要修改 GPU 的硬件，但需要调整 CPU 和 GPU 之间的 I/O 数据传输模块，并将 GPU Driver 运行在 CPU 可信执行环境中。 <br>
    HIX 架构适用于多种加速器，不局限于 GPU
</div>

<h3 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1 Introduction"></a>1 Introduction</h3><div class="original-text">
    In conventional CPU-based computation, hardware-based trusted execution environments (TEE) such as Intel SGX and ARM
    TrustZone have been providing trusted and isolated computing environments to user applications. Such hardware-based TEEs
    reduce the trusted computing base (TCB) of the computation to the processor and critical code running in TEE. With the
    TEE support, security-critical applications can be protected from compromised privileged software as well as
    hardware-based attacks to the memory and system buses, to provide secure computation running on untrusted remote cloud
    servers.
</div>

<div class="analysis-section">
    当今基于硬件实现的 TEE 将 TCB 缩小到处理器和可信代码，提供在不可信云服务器上的可信计算
</div>

<div class="original-text">
    With increasing use of general purpose GPU computing from traditional high performance computing to data center
    acceleration and machine learning applications, securing the GPU computation has become critical to protect security
    sensitive data [34, 45, 56, 57]. However, although even more and more critical data are processed in GPUs, trusted
    computing is yet to be supported in GPU computation. In the current system architecture, high performance discrete GPUs
    communicate with CPUs through I/O interconnects such as PCI Express (PCIe) buses, and the GPU driver which is part of
    the operating system controls the GPUs [25]. As the privileged operating system can fully control the hardware I/O
    interconnects and GPU driver, computing in GPUs is vulnerable to potential attacks on the operating system [8]. Beyond
    the GPU-based computing, the proliferation of various accelerator-based computing models has been increasing the demands for higher-level of security supports for accelerators under the vulnerable privileged software.
</div>

<div class="analysis-section">
    GPU 和 CPU 通过 PCIe 总线进行通信，驱动负责控制通信，OS 完全管理驱动和 PCIe 总线，故 GPU 侧数据很容易受到攻击
</div>

<div class="original-text">
    In existing architectures, both of the code and data in GPUs can be compromised by a privileged adversary. Recent work
    has demonstrated that the integrity of GPU code can be subverted by disrupting and replacing the code at runtime with an
    off-the-shelf reverse engineering tool [13]. In addition to code, data in GPU can potentially be uncovered and leaked
    [45]. GPU data vulnerable to confidentiality attacks comprises both the communication data being transferred to and from
    a GPU, and the data being processed within a GPU. The susceptibility of GPUs to confidentiality and integrity attacks
    stems from the lack of access control to their interfaces such as the I/O interconnects and memory-mapped I/O addresses.
    To support secure computing in GPUs, this paper proposes a novel hardware and software architecture for isolating GPUs
    even from the potentially malicious privileged software (OS and hypervisor). The proposed architecture, called
    Heterogeneous Isolated eXecution (HIX), requires minor extensions to the current PCIe interconnect implementation and
    the TEE support in CPUs. The goal of HIX is to extend the security guarantees, namely confidentiality and integrity of
    user data, of TEE technologies to heterogeneous computing environments. At the time of writing, none of these
    technologies protect accelerators in heterogeneous systems from privileged software attacks; they only protect the code
    and data in trusted “enclaves” running on the processors. In this work, we expand the scope of a widely used trusted
    isolation technology, Intel SGX, to secure general purpose accelerators, in particular GPUs.
</div>

<div class="analysis-section">
    目标：保护 GPU 数据（通信路径上的数据、GPU 内运行的数据）的完整性和机密性 <br>
    产生攻击面的原因：I/O 接口和 MMIO 的控制过少 <br>
    HIX 需要扩展 PCIe interconnect 和 CPU 侧 TEE（扩展 SGX）
</div>

<div class="original-text">
    Our proposed architecture consists of four main hardware and software changes. First, key functions of the GPU driver
    are removed from the operating system (OS) and relocated in a separate process in its own GPU enclave. The GPU enclave
    is an extension of the current SGX enclave, designed to exclusively manage the GPU. Second, the PCIe interconnect
    architecture is slightly modified to prevent the OS from changing the routing configuration of the interconnect, once
    the GPU enclave is completely initialized. Third, the memory management unit (MMU) is augmented to protect the memory
    mapped GPU I/O region from unauthorized accesses. Fourth, the CPU counterpart process of a GPU application runs on an
    SGX enclave, and the SGX enclave sets up a trusted communication path to the GPU enclave, which is robust even against
    privileged adversaries.
    To support the secure execution environments for GPUs without any GPU modification, HIX does not provide the protection
    against direct hardware-based attacks, as PCIe buses and the memory of GPUs are exposed to such hardware attacks in the
    current architecture. Although the security level is lower compared to the hardware TEEs for CPUs, HIX can be extended
    to other accelerators without requiring any modification of the accelerators themselves, if the accelerator is connected via I/O interconnects.
</div>

<div class="analysis-section">
    HIV 的核心功能需要四个主要的硬件/软件修改：
    <ul>
        <li>GPU 驱动的核心函数从内核空间中转移到单独的 GPU enclave</li>
        <li>PCIe 互连组件需要修改，防止 OS 恶意修改其路由配置</li>
        <li>MMU 加强，保护 GPU MMIO 区域被无权限者访问</li>
        <li>和 GPU 进程相对应的主机侧进程在 enclave 中运行</li>
    </ul>
    HIX 不需要修改 GPU 硬件，可以扩展到其他加速器设备上，但防御深度弱于 CPU TEE
</div>

<div class="original-text">
    We evaluate the proposed architecture in terms of security and performance. We have implemented a prototype for HIX on
    KVM and QEMU, adding extra instructions for the GPU enclave and separating the GPU driver from the operating system. The
    prototype using the emulation connected to a real GPU shows that the performance degradation introduced by HIX secure
    GPU computation is 26% compared to the conventional unsecure GPU computation for the benchmarks from the Rodinia suite.
    We summarize the main contributions of this work as follows:
    <ul>
        <li>We provide an attack surface assessment of GPU computation. We identify key GPU components that can be attacked from
        privileged software: PCIe interconnect, memory mapped I/O region, and GPU driver.</li>
        <li>We augment the design of the PCIe interconnect to block any routing change after the GPU initialization, and to further
        guarantee the address mapping immutability of the memory mapped I/O region to the GPU.</li>
        <li>We extend the current SGX interface to support the GPU enclave, which runs the GPU driver in a secure way. The MMU
        design is extended to protect the GPU memory mapped I/O region from unauthorized accesses.</li>
        <li>We implement a prototype on an emulated system with KVM and QEMU to evaluate the performance overhead of HIX. Although
        it is implemented in the emulated system due to the required changes in hardware, it faithfully reflects necessary
        changes in hardware interfaces and software architectures.</li>
    </ul>
    The rest of the paper is organized as follows. Section 2 describes the current architecture of SGX, PCIe, and GPU
    driver. Section 3 discusses the threat model. Section 4 presents the proposed architecture. Section 5 discusses the
    security analysis and shows performance results. Section 6 presents the prior work and Section 7 concludes the paper.
</div>

<div class="analysis-section">
    HIX 的四大贡献：
    <ul>
        <li>特权软件可能会攻击的三大 GPU 组件：PCIe 互连设备、MMIO 区域、GPU 驱动</li>
        <li>加强 PCIe 互连设备，保证 MMIO 映射、PCIe RC 路由无法被非法修改</li>
        <li>扩展 SGX 以支持 GPU enclave，将 GPU 驱动的关键函数以一种安全的方式运行，加强 MMU 防止无权限者访问 GPU MMIO 区域</li>
        <li>完成了性能评估</li>
    </ul>
</div>

<h3 id="2-Background"><a href="#2-Background" class="headerlink" title="2 Background"></a>2 Background</h3><div class="original-text">
    HIX is designed on top of Intel SGX architecture and the PCI Express standard. We provide a brief overview of these
    technologies in this section.
</div>

<div class="analysis-section">
    这部分进行 SGX、PCIe 的简述
</div>

<h4 id="2-1-Intel-Software-Guard-Extensions-SGX"><a href="#2-1-Intel-Software-Guard-Extensions-SGX" class="headerlink" title="2.1 Intel Software Guard Extensions (SGX)"></a>2.1 Intel Software Guard Extensions (SGX)</h4><div class="original-text">
    Intel SGX is a hardware-based protection technology that provides a trusted execution environment (TEE) called an
    enclave, protected even from the privileged software and direct hardware attacks. SGX protects the enclave memory and
    execution contexts to support the strong isolated execution. The SGX hardware-based isolated execution is augmented by an attestation service that verifies the integrity of the code running on the enclave [1, 35].
    The main memory is untrusted under the SGX threat model, and thus, SGX provides memory encryption and access restriction
    mechanisms to protect a small region of main memory for enclaves, called the enclave page cache (EPC). Although SGX uses
    the virtual memory support provided by the untrusted OS, it protects EPC pages from unauthorized accesses with
    hardware-based verification. Figure 1 illustrates the structure of SGX address space. In the figure, ELRANGE (Enclave
    Linear Address Range) is the protected virtual address range in the enclave, and the pages in the range are guaranteed
    to be mapped to EPC pages. When an enclave is created, the system software registers the virtual address and
    corresponding EPC physical address of a page in the protected memory using EADD SGX instruction. During handling of the
    EADD instruction, the hardware stores the mapping information in the enclave page cache map (EPCM) to verify future
    accesses to the page during address translation in MMU [9].
    <img src="/img/HIX/F1.png" srcset="/img/loading.gif" lazyload alt="" style="width: 75%;">
</div>

<div class="analysis-section">
    SGX 架构中：
    <ul>
        <li>飞地对应的内存空间是加密的，并集中在内存的 EPC 区域中</li>
        <li>一个进程虚拟地址中的用户空间被分为可信和不可信部分，可信部分对应的连续虚拟地址段叫做 ELRANGE</li>
        <li>飞地的页表存储在硬件中，叫做 EPCM，飞地的地址映射由 MMU 处理</li>
    </ul>
</div>

<h4 id="2-2-PCI-Express-Architecture"><a href="#2-2-PCI-Express-Architecture" class="headerlink" title="2.2 PCI Express Architecture"></a>2.2 PCI Express Architecture</h4><div class="original-text">
    Modern GPUs are connected to the system via the PCI Express (PCIe) interface. The PCIe interface facilitates
    memorymapped I/O (MMIO) access to PCIe devices for software. Since the MMIO mechanism maps the hardware registers and
    memory of a device to the system memory address space for software, this enables the software to transparently access
    the PCIe devices using regular memory addresses. Figure 2 illustrates how the system routes device access requests to
    the device by using the system memory address map [49]. CPU is responsible for distinguishing accesses to the MMIO
    regions from main memory accesses. It uses its internal hardware registers which are initialized by BIOS at system boot
    time, to route access requests for MMIO appropriately [19]. When the address of a memory access is for the MMIO region,
    the PCIe root complex takes the request. As PCIe devices are attached to the system as a tree, where the PCIe root
    complex is its root, the root complex creates a PCIe transaction packet and routes it to the desired device, using the
    hardware routing registers [5, 43]. These registers are also initialized by the BIOS at system boot time to cover the
    entire physical address ranges of attached devices.
    Modern PCIe devices use direct memory access (DMA) to directly read or write the main memory without CPU intervention.
    The DMA arrows in Figure 2 show how the system routes the DMA request. An input/output memory management unit (IOMMU) can be used to translate device addresses to physical addresses for DMAs [42].
</div>

<div class="analysis-section">
    主机进程利用 MMIO 机制，可以像访问普通内存一样访问设备寄存器，CPU 根据内部寄存器（BIOS 初始化）判断访问的内存地址是普通内存还是 MMIO 区域 <br>
    当访问 MMIO 区域时，PCIe RC 会接受请求，创建一个 PCIe 业务包并将其路由到目标设备（通过硬件路由寄存器） <br>
</div>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/GPU-TEE/" class="print-no-link">#GPU TEE</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>【论文】Heterogeneous Isolated Execution for Commodity GPUs</div>
      <div>https://dmx20070206.github.io/2025/02/18/【论文】Heterogeneous Isolated Execution for Commodity GPUs/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>DM-X~X~X</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>February 18, 2025</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/02/26/%E3%80%90%E8%AE%BA%E6%96%87%E3%80%91Building%20GPU%20TEEs%20using%20CPU%20Secure%20Enclaves%20with%20GEVisor/" title="【论文】Building GPU TEEs using CPU Secure Enclaves with GEVisor">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">【论文】Building GPU TEEs using CPU Secure Enclaves with GEVisor</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/02/17/%E3%80%90%E8%AE%BA%E6%96%87%E3%80%91HyperEnclave%EF%BC%9AAn%20Open%20and%20Cross-platform%20Trusted%20Execution%20Environment/" title="【论文】HyperEnclave：An Open and Cross-platform Trusted Execution Environment">
                        <span class="hidden-mobile">【论文】HyperEnclave：An Open and Cross-platform Trusted Execution Environment</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"LaZlZczZ7WZl8fj2Kff3EQ6N-MdYXbMMI","appKey":"4rxpDeW2APFf9wOxXFRgXfHD","path":"window.location.pathname","placeholder":"4rxpDeW2APFf9wOxXFRgXfHD","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"https://lazlzczz.api.lncldglobal.com","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <span> Welcome to DMX blog </span> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
